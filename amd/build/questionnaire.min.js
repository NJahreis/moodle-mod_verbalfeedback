function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function _iterableToArrayLimit(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("mod_verbalfeedback/questionnaire",["jquery","core/templates","core/notification","core/ajax","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var k=[],l=function(){this.registerEvents();a("[data-region=\"question-row\"]").each(function(){k[a(this).data("criterionid")]={criterionid:a(this).data("criterionid"),value:null,studentcomment:"",privatecomment:""}});var b=a("[data-region=\"questionnaire\"]");if(!0==b.data("preview")){return}var e=b.data("fromuserid"),f=b.data("touserid"),g=b.data("verbalfeedbackid"),h=b.data("submissionid"),i=d.call([{methodname:"mod_verbalfeedback_get_responses",args:{verbalfeedbackid:g,fromuserid:e,touserid:f,submissionid:h}}]);i[0].done(function(b){a.each(b.responses,function(){var b=this;k[b.criterionid].criterionid=b.criterionid;k[b.criterionid].value=b.value;k[b.criterionid].studentcomment=b.studentcomment;k[b.criterionid].privatecomment=b.privatecomment;a("[data-region=\"question-row\"]").each(function(){if(a(this).data("criterionid")===b.criterionid){var c=a(this).find(".scaleoption");if(c){c.each(function(){var c=a(this).find("label");if(c.data("value")===b.value){c.removeClass("badge-secondary");c.removeClass("badge-info");c.addClass("badge-success")}else if(""===c.data("value")&&null===b.value){c.removeClass("badge-secondary");c.removeClass("badge-info");c.addClass("badge-success")}})}var d=a(this).find(".student-comment.editor_atto_content");if(d&&""!==b.studentcomment){d.html(b.studentcomment)}var e=a(this).find(".private-comment.editor_atto_content");if(e&&""!==b.privatecomment){e.html(b.privatecomment)}}})})}).fail(c.exception)};l.prototype.registerEvents=function(){a(".scaleoption").click(function(b){b.preventDefault();var c=a(this).parents("[data-region=\"question-row\"]"),d=c.find("label");a.each(d,function(){if(a(this).hasClass("badge-success")){a(this).removeClass("badge-success");a(this).addClass("badge-secondary");var b=a(this).attr("for"),c=a("#"+b);c.removeAttr("checked")}});var e=a(this).find("label");e.removeClass("badge-secondary");e.removeClass("badge-info");e.addClass("badge-success");var f=a("#"+e.attr("for"));f.attr("checked","checked");var g=c.data("criterionid");if(""===e.data("value")){k[g].value=null}else{k[g].value=e.data("value")}});a(".scaleoptionlabel").hover(function(b){b.preventDefault();if(!a(this).hasClass("badge-success")){if(a(this).hasClass("badge-secondary")){a(this).removeClass("badge-secondary");a(this).addClass("badge-info")}else{a(this).addClass("badge-secondary");a(this).removeClass("badge-info")}}});a(".detail-scaleoption").click(function(b){b.preventDefault();var c=a(this).parents("[data-region=\"detailed-rating\"]");console.log(c.html());var d=a(this).find(".detail-scaleoptionlabel").data("value"),e=c.find(".student-comment.editor_atto_content");console.log(e.html());e.append("<ul><li>"+d+"</li></ul>")});a(".detail-scaleoptionlabel").hover(function(b){b.preventDefault();if(!a(this).hasClass("badge-success")){if(a(this).hasClass("badge-secondary")){a(this).removeClass("badge-secondary");a(this).addClass("badge-info")}else{a(this).addClass("badge-secondary");a(this).removeClass("badge-info")}}});a("#save-feedback").click(function(){h(!1)});a("#submit-feedback").click(function(){h(!0)});a(".btn-detail-rating").click(function(b){b.preventDefault();var c=a(this).parents("[data-region=\"question-row\"]"),d=c.find(".detailed-rating");if(d.hasClass("hidden")){d.removeClass("hidden");a(this).html("\u2212")}else{d.addClass("hidden");a(this).html("+")}})};function h(b){a(".student-comment").each(function(){var b=a(this).parents("[data-region=\"question-row\"]"),c=b.find(".student-comment.editor_atto_content").html();c="<p dir=\"ltr\" style=\"text-align: left;\"><br></p>"==c?"":c;k[b.data("criterionid")].studentcomment=c});a(".private-comment").each(function(){var b=a(this).parents("[data-region=\"question-row\"]"),c=b.find(".private-comment.editor_atto_content").html();c="<p dir=\"ltr\" style=\"text-align: left;\"><br></p>"==c?"":c;k[b.data("criterionid")].privatecomment=c});var d=a("[data-region=\"questionnaire\"]"),f=d.data("touserid"),g=d.data("tousername"),h=d.data("verbalfeedbackid"),l=d.data("submissionid"),m=d.data("anonymous");if(m&&b){e.get_strings([{key:"finaliseanonymousfeedback",component:"mod_verbalfeedback"},{key:"confirmfinaliseanonymousfeedback",component:"mod_verbalfeedback",param:{name:g}}],"mod_verbalfeedback").done(function(a){j(a[0],a[1],h,l,f,k,b)}).fail(c.exception)}else{i(h,l,f,k,b)}}function i(a,b,f,g,h){for(var i=[],j=0,k=Object.entries(g),l;j<k.length;j++){l=_slicedToArray(k[j],2);key=l[0];value=l[1];if(null!==value){i.push(value)}}var m=d.call([{methodname:"mod_verbalfeedback_save_responses",args:{verbalfeedbackid:a,submissionid:b,touserid:f,responses:i,complete:h}}]);m[0].done(function(a){e.get_strings([{key:"responsessaved",component:"mod_verbalfeedback"},{key:"errorresponsesavefailed",component:"mod_verbalfeedback"}]).done(function(b){var d={};if(a.result){d.message=b[0];d.type="success"}else{d.message=b[1];d.type="error"}c.addNotification(d)}).fail(c.exception);if(h){console.log("finalizing")}window.location=a.redirurl}).fail(c.exception)}function j(b,c,d,h,j,k,l){var m=e.get_string("finalise","mod_verbalfeedback"),n=f.create({title:b,body:c,large:!0,type:f.types.SAVE_CANCEL});a.when(m,n).done(function(a,b){b.setSaveButtonText(a);b.show();b.getRoot().on(g.hidden,function(){b.setBody("")});b.getRoot().on(g.save,function(){i(d,h,j,k,l)})})}return l});
//# sourceMappingURL=questionnaire.min.js.map
