{"version":3,"sources":["../src/edit_items.js"],"names":["define","$","Templates","Notification","Ajax","ACTIONS","CATEGORY_PERCENTAGE_CHANGED","ITEM_MULTIPLIER_CHANGED","editItems","registerEvents","updateSum","sum","each","parseFloat","val","addClass","text","toFixed","removeClass","callCategoryAction","action","elem","promises","call","methodname","args","categoryid","data","percentage","done","response","success","next","stop","show","fadeOut","warnings","join","Error","fail","exception","callItemAction","itemid","multiplier","prototype","change","e","preventDefault","value","updatePercentageSum"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_verbalfeedback/edit_items\n * @class      edit_items\n * @package    core\n * @copyright  2020 Kevin Tippenhauer <kevin.tippenhauer@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax',\n    'core/str',\n    'core/yui'\n], function($, Templates, Notification, Ajax) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{CATEGORY_PERCENTAGE_CHANGED: string}, {ITEM_MULTIPLIER_CHANGED: string}}\n     */\n    let ACTIONS = {\n        CATEGORY_PERCENTAGE_CHANGED: '[data-action=\"change-category-percentage\"]',\n        ITEM_MULTIPLIER_CHANGED: '[data-action=\"change-item-multiplier\"]',\n    };\n\n    let editItems = function() {\n        this.registerEvents();\n    };\n\n    let updateSum = function() {\n        let sum = 0.00;\n        $('.category-percentage').each(function() {\n            sum += parseFloat($(this).val());\n        });\n\n        if(sum != 1) {\n            $('.category-percentage').addClass('is-invalid');\n            $('#percentage-total').addClass('text-danger');\n            $('#percentage-total-value').text(parseFloat(sum * 100).toFixed(2));\n        } else {\n            $('.category-percentage').removeClass('is-invalid');\n            $('#percentage-total').removeClass('text-danger');\n            $('#percentage-total-value').text(parseFloat(sum * 100).toFixed(2));\n        }\n    };\n\n    editItems.callCategoryAction = function(action, elem) {\n        updateSum();\n\n        let promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    categoryid: elem.data('categoryid'),\n                    percentage: elem.val()\n                }\n            }\n        ]);\n        promises[0].done(function(response) {\n            if (response.success) {\n              elem.next().stop(true, true).show().fadeOut(1000);\n            } else {\n              let warnings = response.warnings.join($('<br/>'));\n              throw new Error(warnings);\n            }\n        }).fail(Notification.exception);\n    };\n\n    editItems.callItemAction = function(action, elem) {\n        let promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    itemid: elem.data('itemid'),\n                    multiplier: elem.val()\n                }\n            }\n        ]);\n        promises[0].done(function(response) {\n          if (response.success) {\n            elem.next().stop(true, true).show().fadeOut(1000);\n          } else {\n            let warnings = response.warnings.join($('<br />'));\n            throw new Error(warnings);\n          }\n        }).fail(Notification.exception);\n    };\n\n    editItems.prototype.registerEvents = function() {\n\n        $(ACTIONS.CATEGORY_PERCENTAGE_CHANGED).change(function(e) {\n            e.preventDefault();\n            editItems.callCategoryAction('mod_verbalfeedback_update_category_percentage', $(this));\n\n        });\n\n        $(ACTIONS.ITEM_MULTIPLIER_CHANGED).change(function(e) {\n            e.preventDefault();\n            if(this.value > 5) {\n              this.value = 5.00;\n            }\n            this.value = parseFloat(this.value).toFixed(2);\n            editItems.callItemAction('mod_verbalfeedback_update_item_multiplier', $(this));\n        });\n    };\n\n    editItems.prototype.updatePercentageSum = updateSum;\n    return editItems;\n});\n"],"file":"edit_items.min.js"}